<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Tài Khoản Cá Nhân</title>
    <link rel="stylesheet" th:href="@{/css/dangkydv.css}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        .account-container {
            padding: 40px;
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            max-width: 900px;
        }
        
        .account-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #ff6b8a;
        }
        
        .account-title {
            font-size: 36px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .account-subtitle {
            font-size: 16px;
            color: #7f8c8d;
        }
        
        .form-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e0e6ed;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: #f8f9fb;
            color: #2c3e50;
        }
        
        .form-input:focus {
            border-color: #ff6b8a;
            background: #fff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 107, 138, 0.1);
        }
        
        .form-input:disabled {
            background: #ecf0f1;
            color: #7f8c8d;
            cursor: not-allowed;
        }
        
        .gender-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }
        
        .gender-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .gender-option input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: #ff6b8a;
        }
        
        .gender-option label {
            font-weight: 500;
            color: #34495e;
            cursor: pointer;
        }
        
        .button-group {
            grid-column: 1 / -1;
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
        }
        
        .btn {
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 160px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #ff6b8a, #ff8686);
            color: #fff;
            box-shadow: 0 4px 15px rgba(255, 107, 138, 0.3);
        }
        
        .btn-primary:hover {
            background: linear-gradient(45deg, #ff5577, #d84343);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 138, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: #fff;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }
        
        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .readonly-mode .form-input {
            background: #f8f9fb;
            border: 2px solid #e0e6ed;
            cursor: default;
        }
        
        .edit-mode .form-input:not(:disabled) {
            background: #fff;
            border-color: #3498db;
        }
        
        @media (max-width: 768px) {
            .form-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .account-container {
                padding: 20px;
                margin: 10px;
            }
            
            .button-group {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
<div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="user">
            <span class="user-icon">&#128100;</span>
            KHÁCH HÀNG
        </div>
        <nav>
            <ul>
                <li><a href="#" th:href="@{/user/home/{accountId}/{username}(accountId=${accountId}, username=${username})}">Trang chủ</a></li>
                <li><a href="#" th:href="@{/dich-vu-gym/dang-kydv(accountId=${accountId})}">Đăng ký dịch vụ</a></li>
                <li><a href="#">Thuê dụng cụ</a></li>
                <li><a href="#">Xem lịch tập</a></li>
                <li><a href="#">Phản hồi/ Khiếu nại</a></li>
                <li><a href="#">Thanh toán</a></li>
                <li><a href="#" th:href="@{/dich-vu-gym/dich-vu-cua-toi(accountId=${accountId})}">Dịch vụ của tôi</a></li>
                <li><a href="#">Theo dõi khu vực</a></li>
                <li><a href="#">Voucher của tôi</a></li>
                <li><a href="#" th:href="@{/user/taikhoan/{accountId}(accountId=${accountId})}" class="active">Tài khoản</a></li>
            </ul>
        </nav>
        <form th:action="@{/logout}" method="post" style="margin: 0;">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button type="submit" class="logout-btn">ĐĂNG XUẤT</button>
        </form>
    </aside>
    
    <!-- Main Content -->
    <div class="main-content">
        <div class="account-container">
            <div class="account-header">
                <h1 class="account-title">Thông Tin Tài Khoản</h1>
                <p class="account-subtitle">Quản lý và cập nhật thông tin cá nhân của bạn</p>
            </div>
            
            <!-- Alert Messages -->
            <div th:if="${successMessage}" class="alert alert-success">
                <span th:text="${successMessage}"></span>
            </div>
            
            <div th:if="${errorMessage}" class="alert alert-error">
                <span th:text="${errorMessage}"></span>
            </div>
            
            <!-- Account Form -->
            <form id="accountForm" th:action="@{/user/taikhoan/{id}/update(id=${accountId})}" method="post" class="readonly-mode">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                
                <div class="form-container">
                    <!-- Tên đăng nhập -->
                    <div class="form-group">
                        <label class="form-label">Tên đăng nhập</label>
                        <input type="text" class="form-input" th:value="${account.userName}" disabled>
                    </div>
                    
                    <!-- Mã khách hàng -->
                    <div class="form-group">
                        <label class="form-label">Mã khách hàng</label>
                        <input type="text" class="form-input" th:value="${khachHang.maKH}" disabled>
                    </div>
                    
                    <!-- Họ và tên -->
                    <div class="form-group">
                        <label class="form-label">Họ và tên</label>
                        <input type="text" name="hoTen" class="form-input" th:value="${khachHang.hoTen}" required readonly>
                    </div>
                    
                    <!-- Email -->
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" name="email" class="form-input" th:value="${khachHang.email}" required readonly>
                    </div>
                    
                    <!-- Số điện thoại -->
                    <div class="form-group">
                        <label class="form-label">Số điện thoại</label>
                        <input type="tel" name="soDienThoai" class="form-input" th:value="${khachHang.soDienThoai}" required readonly>
                    </div>
                    
                    <!-- Ngày sinh -->
                    <div class="form-group">
                        <label class="form-label">Ngày sinh</label>
                        <input type="date" name="ngaySinh" class="form-input" 
                               th:value="${khachHang.ngaySinh != null ? #temporals.format(khachHang.ngaySinh, 'yyyy-MM-dd') : ''}" readonly>
                    </div>
                    
                    <!-- Địa chỉ -->
                    <div class="form-group full-width">
                        <label class="form-label">Địa chỉ</label>
                        <input type="text" name="diaChi" class="form-input" th:value="${khachHang.diaChi}" required readonly>
                    </div>
                    
                    <!-- Giới tính -->
                    <div class="form-group">
                        <label class="form-label">Giới tính</label>
                        <div class="gender-group">
                            <div class="gender-option">
                                <input type="radio" id="nam" name="gioiTinh" value="Nam" 
                                       th:checked="${khachHang.gioiTinh == 'Nam'}" disabled>
                                <label for="nam">Nam</label>
                            </div>
                            <div class="gender-option">
                                <input type="radio" id="nu" name="gioiTinh" value="Nữ" 
                                       th:checked="${khachHang.gioiTinh == 'Nữ'}" disabled>
                                <label for="nu">Nữ</label>
                            </div>
                            <div class="gender-option">
                                <input type="radio" id="khac" name="gioiTinh" value="Khác" 
                                       th:checked="${khachHang.gioiTinh == 'Khác'}" disabled>
                                <label for="khac">Khác</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Referral Code -->
                    <div class="form-group">
                        <label class="form-label">Mã giới thiệu</label>
                        <input type="text" class="form-input" th:value="${khachHang.referralCode}" disabled>
                    </div>
                    
                    <!-- Buttons -->
                    <div class="button-group">
                        <button type="button" id="editBtn" class="btn btn-primary">Chỉnh sửa</button>
                        <button type="submit" id="saveBtn" class="btn btn-primary" style="display: none;">Lưu thay đổi</button>
                        <button type="button" id="cancelBtn" class="btn btn-secondary" style="display: none;">Hủy</button>
                        <a href="#" th:href="@{/user/home/{accountId}/{username}(accountId=${accountId}, username=${username})}" 
                           class="btn btn-secondary">Quay lại</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('accountForm');
    const editBtn = document.getElementById('editBtn');
    const saveBtn = document.getElementById('saveBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const inputs = form.querySelectorAll('input[name]');
    const radioInputs = form.querySelectorAll('input[type="radio"]');
    
    let originalValues = {};
    
    // Lưu giá trị ban đầu
    function saveOriginalValues() {
        inputs.forEach(input => {
            if (input.type === 'radio') {
                originalValues[input.name] = form.querySelector(`input[name="${input.name}"]:checked`)?.value || '';
            } else {
                originalValues[input.name] = input.value;
            }
        });
    }
    
    // Khôi phục giá trị ban đầu
    function restoreOriginalValues() {
        inputs.forEach(input => {
            if (input.type === 'radio') {
                input.checked = input.value === originalValues[input.name];
            } else {
                input.value = originalValues[input.name];
            }
        });
    }
    
    // Chế độ chỉnh sửa
    function enableEditMode() {
        form.classList.remove('readonly-mode');
        form.classList.add('edit-mode');
        
        inputs.forEach(input => {
            input.removeAttribute('readonly');
        });
        
        radioInputs.forEach(input => {
            input.removeAttribute('disabled');
        });
        
        editBtn.style.display = 'none';
        saveBtn.style.display = 'inline-block';
        cancelBtn.style.display = 'inline-block';
    }
    
    // Chế độ chỉ đọc
    function enableReadonlyMode() {
        form.classList.remove('edit-mode');
        form.classList.add('readonly-mode');
        
        inputs.forEach(input => {
            input.setAttribute('readonly', true);
        });
        
        radioInputs.forEach(input => {
            input.setAttribute('disabled', true);
        });
        
        editBtn.style.display = 'inline-block';
        saveBtn.style.display = 'none';
        cancelBtn.style.display = 'none';
    }
    
    // Event listeners
    editBtn.addEventListener('click', function() {
        saveOriginalValues();
        enableEditMode();
    });
    
    cancelBtn.addEventListener('click', function() {
        restoreOriginalValues();
        enableReadonlyMode();
    });
    
    // Khởi tạo
    saveOriginalValues();
});
</script>
</body>
</html> 