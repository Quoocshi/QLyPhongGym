<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Chọn lớp học</title>
    <link rel="stylesheet" th:href="@{/css/dangkydv.css}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="user">
            <span class="user-icon">&#128100;</span>
            KHÁCH HÀNG
        </div>
        <nav>
            <ul>
                <li><a href="#" th:href="@{/user/home/{accountId}/{username}(accountId=${accountId}, username=${username})}">Trang chủ</a></li>
                <li><a href="#" class="active">Đăng ký dịch vụ</a></li>
                <li><a href="#">Thuê dụng cụ</a></li>
                <li><a href="#">Xem lịch tập</a></li>
                <li><a href="#">Phản hồi/ Khiếu nại</a></li>
                <li><a href="#">Thanh toán</a></li>
                <li><a href="#" th:href="@{/dich-vu-gym/dich-vu-cua-toi(accountId=${accountId})}">Dịch vụ của tôi</a></li>
                <li><a href="#">Theo dõi khu vực</a></li>
                <li><a href="#">Voucher của tôi</a></li>
                <li><a href="#">Tài khoản</a></li>
            </ul>
        </nav>
        <form th:action="@{/logout}" method="post" style="margin: 0;">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <button type="submit" class="logout-btn">ĐĂNG XUẤT</button>
        </form>
    </aside>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Header với nút quay lại -->
        <div class="back-to-bo-mon">
            <button onclick="goBackToBoMon()" class="back-btn-bo-mon">← Quay lại dịch vụ</button>
            <h1 th:text="'CHỌN LỚP CHO ' + ${dichVu.tenDV}"></h1>
        </div>
        
        <!-- Thông tin dịch vụ -->
        <div class="service-info">
            <div class="service-detail-card">
                <img th:src="@{'/images/' + ${dichVu.maDV == 'YOGA' ? 'Yoga.png' : 
                                              dichVu.maDV == 'ZUMBA' ? 'Zumba.jpg' : 'UIT.png'}}" 
                     th:alt="${dichVu.tenDV}">
                <div class="service-detail-content">
                    <h2 th:text="${dichVu.tenDV}"></h2>
                    <div th:utext="'Hình thức tập luyện: ' + 
                                   ${dichVu.loaiDV == 'Lop' ? 'Lớp' : dichVu.loaiDV} + 
                                   '<br>Thời hạn: ' + ${dichVu.thoiHan} + ' ngày'"></div>
                    <div th:text="'Giá tiền: ' + ${#numbers.formatDecimal(dichVu.donGia, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'"></div>
                </div>
            </div>
        </div>
        
        <!-- Danh sách lớp học -->
        <div class="section-title">Chọn lớp học (chỉ được chọn 1 lớp)</div>
        <div class="classes-grid">
            <div class="class-card" data-class-id="1">
                <div class="class-time">7:00 - 8:30</div>
                <div class="class-info">
                    <div class="class-name">Lớp sáng</div>
                    <div class="class-instructor">HLV: Nguyễn Văn A</div>
                    <div class="class-capacity">Sức chứa: 20 người</div>
                    <div class="class-available">Còn trống: 5 chỗ</div>
                </div>
                <button class="select-class-btn" onclick="selectClass(1, 'Lớp sáng 7:00-8:30')">CHỌN LỚP</button>
            </div>
            
            <div class="class-card" data-class-id="2">
                <div class="class-time">18:00 - 19:30</div>
                <div class="class-info">
                    <div class="class-name">Lớp tối</div>
                    <div class="class-instructor">HLV: Trần Thị B</div>
                    <div class="class-capacity">Sức chứa: 25 người</div>
                    <div class="class-available">Còn trống: 10 chỗ</div>
                </div>
                <button class="select-class-btn" onclick="selectClass(2, 'Lớp tối 18:00-19:30')">CHỌN LỚP</button>
            </div>
            
            <div class="class-card" data-class-id="3">
                <div class="class-time">19:30 - 21:00</div>
                <div class="class-info">
                    <div class="class-name">Lớp nâng cao</div>
                    <div class="class-instructor">HLV: Lê Văn C</div>
                    <div class="class-capacity">Sức chứa: 15 người</div>
                    <div class="class-available">Còn trống: 3 chỗ</div>
                </div>
                <button class="select-class-btn" onclick="selectClass(3, 'Lớp nâng cao 19:30-21:00')">CHỌN LỚP</button>
            </div>
        </div>
        
        <!-- Hidden inputs để lưu thông tin -->
        <input type="hidden" id="dichvu-maDV" th:value="${dichVu.maDV}">
        <input type="hidden" id="dichvu-tenDV" th:value="${dichVu.tenDV}">
        <input type="hidden" id="dichvu-donGia" th:value="${dichVu.donGia}">
        <input type="hidden" id="dichvu-accountId" th:value="${accountId}">
    </div>
</div>

<script>
function selectClass(classId, className) {
    if (confirm(`Bạn có chắc chắn muốn đăng ký "${className}"?`)) {
        // Lấy thông tin dịch vụ
        const maDV = document.getElementById('dichvu-maDV').value;
        const tenDV = document.getElementById('dichvu-tenDV').value;
        const donGia = document.getElementById('dichvu-donGia').value;
        const accountId = document.getElementById('dichvu-accountId').value;
        
        // Tạo tên dịch vụ với thông tin lớp
        const serviceNameWithClass = `${tenDV} - ${className}`;
        
        // Thêm dịch vụ vào sessionStorage
        const registeredServices = JSON.parse(sessionStorage.getItem('registeredServices') || '[]');
        
        // Kiểm tra xem dịch vụ đã được đăng ký chưa
        const existingService = registeredServices.find(service => service.code === maDV);
        if (existingService) {
            alert('Dịch vụ này đã được đăng ký!');
            return;
        }
        
        // Thêm dịch vụ với thông tin lớp
        registeredServices.push({
            name: serviceNameWithClass,
            code: maDV,
            trainingType: 'Lớp',
            price: parseInt(donGia),
            classId: classId,
            className: className
        });
        
        // Lưu vào sessionStorage
        sessionStorage.setItem('registeredServices', JSON.stringify(registeredServices));
        
        // Hiển thị thông báo thành công
        alert(`Đã thêm "${serviceNameWithClass}" vào giỏ hàng!`);
        
        // Chuyển về trang bộ môn
        goBackToBoMon();
    }
}

function goBackToBoMon() {
    const accountId = document.getElementById('dichvu-accountId').value;
    
    // Lấy thông tin bộ môn từ sessionStorage
    const selectedService = JSON.parse(sessionStorage.getItem('selectedService') || '{}');
    const maBM = selectedService.maBM;
    
    if (maBM && accountId) {
        window.location.href = `/dich-vu-gym/dich-vu-theo-bo-mon?maBM=${maBM}&accountId=${accountId}`;
    } else {
        // Fallback nếu không có thông tin bộ môn
        alert('Không tìm thấy thông tin bộ môn. Quay lại trang chủ đăng ký dịch vụ.');
        window.location.href = `/dich-vu-gym/dang-kydv?accountId=${accountId}`;
    }
}
</script>

<style>
.service-info {
    margin-bottom: 30px;
}

.classes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.class-card {
    background: white;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.class-card:hover {
    border-color: #007bff;
    transform: translateY(-5px);
}

.class-time {
    font-size: 24px;
    font-weight: bold;
    color: #007bff;
    margin-bottom: 15px;
    text-align: center;
}

.class-info {
    margin-bottom: 20px;
}

.class-name {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 8px;
    color: #333;
}

.class-instructor, .class-capacity, .class-available {
    font-size: 14px;
    color: #666;
    margin-bottom: 5px;
}

.class-available {
    color: #28a745;
    font-weight: 500;
}

.select-class-btn {
    width: 100%;
    background: linear-gradient(135deg, #007bff, #0056b3);
    color: white;
    border: none;
    padding: 12px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.select-class-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,123,255,0.3);
}

.section-title {
    font-size: 24px;
    font-weight: 600;
    margin-bottom: 20px;
    color: #333;
    text-align: center;
}

.service-detail-card {
    display: flex;
    background: white;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    align-items: center;
    gap: 20px;
}

.service-detail-card img {
    width: 150px;
    height: 150px;
    object-fit: cover;
    border-radius: 10px;
}

.service-detail-content h2 {
    margin-bottom: 10px;
    color: #333;
}

.service-detail-content div {
    margin-bottom: 8px;
    color: #666;
}
</style>
</body>
</html> 