<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Th√™m nh√¢n vi√™n</title>
    <link rel="stylesheet" th:href="@{/css/qlycus.css}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="user">
            <span class="user-icon">&#128100;</span>
            <span class="user-title">QU·∫¢N L√ù</span>
        </div>
        <nav>
            <ul>
                <li><a href="#" id="adminHomeLink">Trang ch·ªß</a></li>
                <li><a th:href="@{/quan-ly-khach-hang/danh-sach-khach-hang}">Qu·∫£n l√Ω kh√°ch h√†ng</a></li>
                <li><a th:href="@{/quan-ly-dich-vu/danh-sach-dich-vu}">Qu·∫£n l√Ω d·ªãch v·ª•</a></li>
                <li><a th:href="@{/quan-ly-bo-mon/danh-sach-bo-mon}">Qu·∫£n l√Ω b·ªô m√¥n</a></li>
                <li><a href="#">Qu·∫£n l√Ω l·ªõp</a></li>
                <li><a href="#">Qu·∫£n l√Ω l·ªãch t·∫≠p</a></li>
                <li><a href="#">Qu·∫£n l√Ω CTKM</a></li>
                <li><a href="#">Qu·∫£n l√Ω voucher</a></li>
                <li><a href="#">Qu·∫£n l√Ω thi·∫øt b·ªã</a></li>
                <li><a href="#">Qu·∫£n l√Ω khu v·ª±c</a></li>
                <li class="active"><a th:href="@{/quan-ly-nhan-vien/danh-sach-nhan-vien}">Qu·∫£n l√Ω nh√¢n vi√™n</a></li>
            </ul>
        </nav>
        <form th:action="@{/logout}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="logout-btn">ƒêƒÇNG XU·∫§T</button>
        </form>
    </aside>

    <!-- Main content -->
    <main class="main-content">
        <h1>TH√äM NH√ÇN VI√äN M·ªöI</h1>

        <!-- Th√¥ng b√°o -->
        <div th:if="${successMessage}" class="alert alert-success">
            <span th:text="${successMessage}"></span>
        </div>
        <div th:if="${errorMessage}" class="alert alert-error">
            <span th:text="${errorMessage}"></span>
        </div>

        <!-- Back to list button -->
        <div style="margin-bottom: 20px; text-align: center;">
            <a th:href="@{/quan-ly-nhan-vien/danh-sach-nhan-vien}" class="edit-btn">‚Üê Quay l·∫°i danh s√°ch</a>
        </div>

        <!-- Khung hi·ªÉn th·ªã r√†ng bu·ªôc validation -->
        <div class="validation-rules-box" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; font-size: 20px; font-weight: 700;">
                    üìã QUY T·∫ÆC T·∫†O T√ÄI KHO·∫¢N NH√ÇN VI√äN
                </h3>
                <button type="button" id="toggleRules" style="background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px; transition: all 0.3s ease;">
                    üîΩ ·∫®n quy t·∫Øc
                </button>
            </div>
            
            <div id="rulesContent">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                    <!-- C·ªôt tr√°i: Th√¥ng tin c∆° b·∫£n -->
                    <div>
                        <h4 style="margin: 0 0 15px 0; color: #ffd700; font-size: 16px; font-weight: 600;">
                            üë§ TH√îNG TIN C∆† B·∫¢N
                        </h4>
                        <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                            <li><strong>T√™n nh√¢n vi√™n:</strong> 2-50 k√Ω t·ª±, ch·ªâ ch·ªØ c√°i v√† kho·∫£ng tr·∫Øng</li>
                            <li><strong>Email:</strong> Ph·∫£i ƒë√∫ng ƒë·ªãnh d·∫°ng v√† ch∆∞a t·ªìn t·∫°i trong h·ªá th·ªëng</li>
                            <li><strong>Gi·ªõi t√≠nh:</strong> Ch·ªâ ch·ªçn Nam ho·∫∑c N·ªØ</li>
                            <li><strong>Ng√†y sinh:</strong> Ph·∫£i l√† ng√†y trong qu√° kh·ª©</li>
                            <li><strong>Ng√†y v√†o l√†m:</strong> Kh√¥ng ƒë∆∞·ª£c l√† ng√†y t∆∞∆°ng lai</li>
                        </ul>
                    </div>
                    
                    <!-- C·ªôt ph·∫£i: T√†i kho·∫£n v√† m·∫≠t kh·∫©u -->
                    <div>
                        <h4 style="margin: 0 0 15px 0; color: #ffd700; font-size: 16px; font-weight: 600;">
                            üîê T√ÄI KHO·∫¢N & M·∫¨T KH·∫®U
                        </h4>
                        <ul style="margin: 0; padding-left: 20px; line-height: 1.8;">
                            <li><strong>Username:</strong> S·ª≠ d·ª•ng email l√†m t√†i kho·∫£n ƒëƒÉng nh·∫≠p</li>
                            <li><strong>M·∫≠t kh·∫©u:</strong> T·ªëi thi·ªÉu 6 k√Ω t·ª±</li>
                            <li><strong>B·∫Øt bu·ªôc c√≥:</strong> 1 ch·ªØ th∆∞·ªùng, 1 ch·ªØ HOA, 1 ch·ªØ s·ªë</li>
                            <li><strong>X√°c nh·∫≠n:</strong> M·∫≠t kh·∫©u v√† x√°c nh·∫≠n ph·∫£i kh·ªõp nhau</li>
                            <li><strong>Quy·ªÅn h·∫°n:</strong> T·ª± ƒë·ªông g√°n theo lo·∫°i nh√¢n vi√™n</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Ph·∫ßn quy·ªÅn h·∫°n -->
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.3);">
                    <h4 style="margin: 0 0 15px 0; color: #ffd700; font-size: 16px; font-weight: 600; text-align: center;">
                        üèÜ PH√ÇN QUY·ªÄN H·ªÜ TH·ªêNG
                    </h4>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; text-align: center;">
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                            <strong style="color: #ff6b6b;">üëë QU·∫¢N L√ù</strong><br>
                            <small>To√†n quy·ªÅn h·ªá th·ªëng</small>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                            <strong style="color: #4ecdc4;">üè¢ L·ªÑ T√ÇN</strong><br>
                            <small>Qu·∫£n l√Ω kh√°ch h√†ng & d·ªãch v·ª•</small>
                        </div>
                        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px;">
                            <strong style="color: #45b7d1;">üí™ TRAINER</strong><br>
                            <small>Hu·∫•n luy·ªán & t∆∞ v·∫•n</small>
                        </div>
                    </div>
                </div>
                
                <!-- L∆∞u √Ω quan tr·ªçng -->
                <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px; border-left: 4px solid #ffd700;">
                    <strong style="color: #ffd700;">‚ö†Ô∏è L∆∞U √ù:</strong> Email s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng l√†m t√†i kho·∫£n ƒëƒÉng nh·∫≠p v√† kh√¥ng th·ªÉ thay ƒë·ªïi sau khi t·∫°o. Vui l√≤ng ki·ªÉm tra k·ªπ tr∆∞·ªõc khi x√°c nh·∫≠n!
                </div>
            </div>
        </div>

        <!-- Form th√™m nh√¢n vi√™n -->
        <div class="table-container">
            <form th:action="@{/quan-ly-nhan-vien/them-nhan-vien}" method="post" th:object="${nhanVien}">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                
                <!-- Hidden inputs to store backend generated codes for JavaScript -->
                <input type="hidden" id="nextMaNV" th:value="${nextMaNV}" />
                <input type="hidden" id="nextMaQL" th:value="${nextMaQL}" />
                <input type="hidden" id="nextMaPT" th:value="${nextMaPT}" />
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px; background: white; border-radius: 12px; box-shadow: 0 2px 8px #eee;">
                    
                    <!-- C·ªôt tr√°i -->
                    <div>
                        <div class="form-group">
                            <label for="maNV">M√£ nh√¢n vi√™n *</label>
                            <input type="text" th:field="*{maNV}" id="maNV" required readonly style="background: #f8f9fa;">
                        </div>

                        <div class="form-group">
                            <label for="tenNV">T√™n nh√¢n vi√™n *</label>
                            <input type="text" th:field="*{tenNV}" id="tenNV" required>
                        </div>

                        <div class="form-group">
                            <label for="email">Email *</label>
                            <input type="email" th:field="*{email}" id="email" required>
                        </div>

                        <div class="form-group">
                            <label for="gioiTinh">Gi·ªõi t√≠nh *</label>
                            <select th:field="*{gioiTinh}" id="gioiTinh" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
                                <option value="">-- Ch·ªçn gi·ªõi t√≠nh --</option>
                                <option value="Nam">Nam</option>
                                <option value="N·ªØ">N·ªØ</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- C·ªôt ph·∫£i -->
                    <div>
                        <div class="form-group">
                            <label for="ngaySinh">Ng√†y sinh *</label>
                            <input type="date" th:field="*{ngaySinh}" id="ngaySinh" required>
                        </div>

                        <div class="form-group">
                            <label for="ngayVaoLam">Ng√†y v√†o l√†m *</label>
                            <input type="date" th:field="*{ngayVaoLam}" id="ngayVaoLam" required>
                        </div>

                        <div class="form-group">
                            <label for="loaiNV">Lo·∫°i nh√¢n vi√™n *</label>
                            <select th:field="*{loaiNV}" id="loaiNV" required onchange="updateEmployeeCode()" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
                                <option value="">-- Ch·ªçn lo·∫°i nh√¢n vi√™n --</option>
                                <option value="QuanLy">Qu·∫£n l√Ω</option>
                                <option value="LeTan">L·ªÖ t√¢n</option>
                                <option value="Trainer">Trainer</option>
                            </select>
                        </div>

                        <!-- Th√¥ng tin t√†i kho·∫£n -->
                        <div class="form-group">
                            <label>T√†i kho·∫£n ƒëƒÉng nh·∫≠p</label>
                            <div style="background: #f8f9fa; padding: 12px; border-radius: 8px; font-size: 14px; color: #666;">
                                <p><strong>Username:</strong> <span id="accountUsername">[S·∫Ω s·ª≠ d·ª•ng email l√†m username]</span></p>
                                <input type="password" name="rawPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required />
                                <input type="password" name="confirmPassword" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u" required />
                                <p><strong>Quy·ªÅn h·∫°n:</strong> <span id="roleDesc">Ch·ªçn lo·∫°i nh√¢n vi√™n ƒë·ªÉ xem quy·ªÅn h·∫°n</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Buttons -->
                <div style="text-align: center; margin-top: 20px;">
                    <button type="submit" class="add-modal-btn">TH√äM NH√ÇN VI√äN</button>
                    <button type="reset" class="delete-btn" style="margin-left: 10px;">X√ìA FORM</button>
                </div>
            </form>
        </div>
    </main>
</div>

<script>
// Set employee code based on type using backend generated codes
function updateEmployeeCode() {
    const loaiNV = document.getElementById('loaiNV').value;
    const maNVInput = document.getElementById('maNV');
    const roleDesc = document.getElementById('roleDesc');
    
    if (loaiNV) {
        let employeeCode = '';
        let role = '';
        
        // Get pre-generated codes from hidden inputs
        const nextMaNV = document.getElementById('nextMaNV').value;
        const nextMaQL = document.getElementById('nextMaQL').value;
        const nextMaPT = document.getElementById('nextMaPT').value;
        
        switch(loaiNV) {
            case 'QuanLy':
                employeeCode = nextMaQL;
                role = 'Qu·∫£n l√Ω - To√†n quy·ªÅn h·ªá th·ªëng';
                break;
            case 'LeTan':
                employeeCode = nextMaNV;
                role = 'Nh√¢n vi√™n - Qu·∫£n l√Ω kh√°ch h√†ng v√† d·ªãch v·ª•';
                break;
            case 'Trainer':
                employeeCode = nextMaPT;
                role = 'Trainer - Hu·∫•n luy·ªán v√† t∆∞ v·∫•n kh√°ch h√†ng';
                break;
            case 'PhongTap':
                employeeCode = nextMaNV;
                role = 'Nh√¢n vi√™n ph√≤ng t·∫≠p - H·ªó tr·ª£ kh√°ch h√†ng';
                break;
        }
        
        maNVInput.value = employeeCode;
        roleDesc.textContent = role;
    } else {
        maNVInput.value = '';
        roleDesc.textContent = 'Ch·ªçn lo·∫°i nh√¢n vi√™n ƒë·ªÉ xem quy·ªÅn h·∫°n';
    }
}

// Update email display dynamically
document.getElementById('email').addEventListener('input', function() {
    const email = this.value.trim();
    const accountUsername = document.getElementById('accountUsername');
    if (email) {
        accountUsername.textContent = email;
        accountUsername.style.color = '#28a745';
        accountUsername.style.fontWeight = 'bold';
    } else {
        accountUsername.textContent = '[S·∫Ω s·ª≠ d·ª•ng email l√†m username]';
        accountUsername.style.color = '#666';
        accountUsername.style.fontWeight = 'normal';
    }
});

// Real-time password validation
function setupPasswordValidation() {
    const passwordInput = document.querySelector('input[name="rawPassword"]');
    const confirmInput = document.querySelector('input[name="confirmPassword"]');
    
    if (passwordInput && confirmInput) {
        // T·∫°o validation display
        const validationDisplay = document.createElement('div');
        validationDisplay.id = 'password-validation';
        validationDisplay.style.cssText = `
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            font-size: 12px;
        `;
        confirmInput.parentNode.appendChild(validationDisplay);
        
        function validatePassword() {
            const password = passwordInput.value;
            const confirm = confirmInput.value;
            const display = document.getElementById('password-validation');
            
            const checks = [
                { test: password.length >= 6, text: 'T·ªëi thi·ªÉu 6 k√Ω t·ª±' },
                { test: /[a-z]/.test(password), text: 'C√≥ ch·ªØ th∆∞·ªùng' },
                { test: /[A-Z]/.test(password), text: 'C√≥ ch·ªØ HOA' },
                { test: /\d/.test(password), text: 'C√≥ ch·ªØ s·ªë' },
                { test: password === confirm && password.length > 0, text: 'M·∫≠t kh·∫©u kh·ªõp nhau' }
            ];
            
            let html = '<strong>Ki·ªÉm tra m·∫≠t kh·∫©u:</strong><br>';
            checks.forEach(check => {
                const icon = check.test ? '‚úÖ' : '‚ùå';
                const color = check.test ? '#28a745' : '#dc3545';
                html += `<span style="color: ${color};">${icon} ${check.text}</span><br>`;
            });
            
            display.innerHTML = html;
            
            // Update border colors
            const allValid = checks.every(check => check.test);
            passwordInput.style.borderColor = password.length > 0 ? (checks.slice(0, 3).every(c => c.test) ? '#28a745' : '#dc3545') : '#ddd';
            confirmInput.style.borderColor = confirm.length > 0 ? (checks[4].test ? '#28a745' : '#dc3545') : '#ddd';
        }
        
        passwordInput.addEventListener('input', validatePassword);
        confirmInput.addEventListener('input', validatePassword);
    }
}

// Setup validation on page load
document.addEventListener('DOMContentLoaded', function() {
    setupPasswordValidation();
    
    // Setup toggle rules functionality
    const toggleBtn = document.getElementById('toggleRules');
    const rulesContent = document.getElementById('rulesContent');
    let isVisible = true;
    
    toggleBtn.addEventListener('click', function() {
        isVisible = !isVisible;
        if (isVisible) {
            rulesContent.style.display = 'block';
            toggleBtn.innerHTML = 'üîΩ ·∫®n quy t·∫Øc';
            toggleBtn.style.background = 'rgba(255,255,255,0.2)';
        } else {
            rulesContent.style.display = 'none';
            toggleBtn.innerHTML = 'üîº Hi·ªán quy t·∫Øc';
            toggleBtn.style.background = 'rgba(255,255,255,0.3)';
        }
    });
    
    // Admin home link setup
    const adminHomeLink = document.getElementById('adminHomeLink');
    const savedUserId = sessionStorage.getItem('adminUserId');
    const savedUsername = sessionStorage.getItem('adminUsername');
    
    if (savedUserId && savedUsername) {
        adminHomeLink.href = `/admin/home/${savedUserId}/${savedUsername}`;
    } else {
        adminHomeLink.href = '/login';
    }
});
</script>

</body>
</html> 
