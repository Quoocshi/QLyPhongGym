# HÆ¯á»šNG DáºªN TEST TÃNH NÄ‚NG VALIDATION Dá»ŠCH Vá»¤

## ğŸ“‹ MÃ´ táº£ tÃ­nh nÄƒng

**Quy táº¯c Business**: 

1. **Má»—i bá»™ mÃ´n chá»‰ Ä‘Æ°á»£c chá»n má»™t loáº¡i dá»‹ch vá»¥** (Tá»± Do HOáº¶C Lá»›p/PT)
   - âŒ **Náº¿u Ä‘Ã£ cÃ³ Lá»›p/PT** cá»§a bá»™ mÃ´n X â†’ **khÃ´ng Ä‘Æ°á»£c Ä‘Äƒng kÃ½ TuDo** cá»§a bá»™ mÃ´n X
   - âŒ **Náº¿u Ä‘Ã£ cÃ³ TuDo** cá»§a bá»™ mÃ´n X â†’ **khÃ´ng Ä‘Æ°á»£c Ä‘Äƒng kÃ½ Lá»›p/PT** cá»§a bá»™ mÃ´n X

2. **Má»—i bá»™ mÃ´n chá»‰ Ä‘Æ°á»£c cÃ³ tá»‘i Ä‘a 1 dá»‹ch vá»¥ PT**
   - âŒ **Náº¿u Ä‘Ã£ cÃ³ PT** cá»§a bá»™ mÃ´n X â†’ **khÃ´ng Ä‘Æ°á»£c Ä‘Äƒng kÃ½ PT khÃ¡c** cá»§a bá»™ mÃ´n X
   - âœ… **CÃ³ thá»ƒ Ä‘Äƒng kÃ½ nhiá»u Lá»›p** cá»§a cÃ¹ng bá»™ mÃ´n (náº¿u cáº§n)

- âœ… **CÃ³ thá»ƒ xem** dá»‹ch vá»¥ nhÆ°ng **khÃ´ng Ä‘Æ°á»£c Ä‘Äƒng kÃ½** khi vi pháº¡m quy táº¯c

## ğŸ§ª CÃ¡c trÆ°á»ng há»£p test

### **Test Case 1: ÄÄƒng kÃ½ TuDo sau khi cÃ³ Lá»›p**
1. ÄÄƒng kÃ½ dá»‹ch vá»¥ **YOGA Lop 30N** (chá»n lá»›p)
2. Thá»­ Ä‘Äƒng kÃ½ dá»‹ch vá»¥ **YOGA TuDo 30N**  
3. **Káº¿t quáº£ mong Ä‘á»£i**: âŒ Hiá»ƒn thá»‹ lá»—i: *"KhÃ´ng thá»ƒ Ä‘Äƒng kÃ½ dá»‹ch vá»¥ Tá»± Do YOGA vÃ¬ báº¡n Ä‘Ã£ cÃ³ dá»‹ch vá»¥ Lá»›p cá»§a YOGA trong giá» hÃ ng"*

### **Test Case 2: ÄÄƒng kÃ½ TuDo sau khi cÃ³ PT**
1. ÄÄƒng kÃ½ dá»‹ch vá»¥ **GYM PT 30N** (chá»n trainer)
2. Thá»­ Ä‘Äƒng kÃ½ dá»‹ch vá»¥ **GYM TuDo 30N**
3. **Káº¿t quáº£ mong Ä‘á»£i**: âŒ Hiá»ƒn thá»‹ lá»—i: *"KhÃ´ng thá»ƒ Ä‘Äƒng kÃ½ dá»‹ch vá»¥ Tá»± Do GYM vÃ¬ báº¡n Ä‘Ã£ cÃ³ dá»‹ch vá»¥ Personal Trainer cá»§a GYM trong giá» hÃ ng"*

### **Test Case 3: ÄÄƒng kÃ½ Lá»›p sau khi cÃ³ TuDo**
1. ÄÄƒng kÃ½ dá»‹ch vá»¥ **ZUMBA TuDo 30N**
2. Thá»­ Ä‘Äƒng kÃ½ dá»‹ch vá»¥ **ZUMBA Lop 30N** (chá»n lá»›p)
3. **Káº¿t quáº£ mong Ä‘á»£i**: âŒ Hiá»ƒn thá»‹ lá»—i: *"KhÃ´ng thá»ƒ Ä‘Äƒng kÃ½ dá»‹ch vá»¥ Lá»›p ZUMBA vÃ¬ báº¡n Ä‘Ã£ cÃ³ dá»‹ch vá»¥ Tá»± Do cá»§a ZUMBA trong giá» hÃ ng"*

### **Test Case 4: ÄÄƒng kÃ½ PT sau khi cÃ³ TuDo**
1. ÄÄƒng kÃ½ dá»‹ch vá»¥ **CARDIO TuDo 30N**
2. Thá»­ Ä‘Äƒng kÃ½ dá»‹ch vá»¥ **CARDIO PT 30N** (chá»n trainer)
3. **Káº¿t quáº£ mong Ä‘á»£i**: âŒ Hiá»ƒn thá»‹ lá»—i: *"KhÃ´ng thá»ƒ Ä‘Äƒng kÃ½ dá»‹ch vá»¥ Personal Trainer CARDIO vÃ¬ báº¡n Ä‘Ã£ cÃ³ dá»‹ch vá»¥ Tá»± Do cá»§a CARDIO trong giá» hÃ ng"*

### **Test Case 5: ÄÄƒng kÃ½ khÃ¡c bá»™ mÃ´n (Há»£p lá»‡)**
1. ÄÄƒng kÃ½ dá»‹ch vá»¥ **GYM TuDo 30N**
2. ÄÄƒng kÃ½ dá»‹ch vá»¥ **YOGA Lop 30N** (chá»n lá»›p)
3. **Káº¿t quáº£ mong Ä‘á»£i**: âœ… ThÃ nh cÃ´ng vÃ¬ khÃ¡c bá»™ mÃ´n

### **Test Case 6: ÄÄƒng kÃ½ 2 PT cÃ¹ng bá»™ mÃ´n (Vi pháº¡m quy táº¯c má»›i)**
1. ÄÄƒng kÃ½ dá»‹ch vá»¥ **GYM PT 7N** (chá»n trainer A)
2. Thá»­ Ä‘Äƒng kÃ½ dá»‹ch vá»¥ **GYM PT 30N** (chá»n trainer B)
3. **Káº¿t quáº£ mong Ä‘á»£i**: âŒ Hiá»ƒn thá»‹ lá»—i: *"KhÃ´ng thá»ƒ Ä‘Äƒng kÃ½ thÃªm dá»‹ch vá»¥ Personal Trainer GYM vÃ¬ báº¡n Ä‘Ã£ cÃ³ dá»‹ch vá»¥ PT khÃ¡c cá»§a GYM trong giá» hÃ ng"*

### **Test Case 7: ÄÄƒng kÃ½ PT khÃ¡c bá»™ mÃ´n (Há»£p lá»‡)**
1. ÄÄƒng kÃ½ dá»‹ch vá»¥ **GYM PT 30N** (chá»n trainer)
2. ÄÄƒng kÃ½ dá»‹ch vá»¥ **CARDIO PT 30N** (chá»n trainer)
3. **Káº¿t quáº£ mong Ä‘á»£i**: âœ… ThÃ nh cÃ´ng vÃ¬ khÃ¡c bá»™ mÃ´n

### **Test Case 8: ÄÄƒng kÃ½ cÃ¹ng loáº¡i dá»‹ch vá»¥ TuDo (Há»£p lá»‡)**
1. ÄÄƒng kÃ½ dá»‹ch vá»¥ **GYM TuDo 7N**
2. ÄÄƒng kÃ½ dá»‹ch vá»¥ **GYM TuDo 30N**
3. **Káº¿t quáº£ mong Ä‘á»£i**: âœ… ThÃ nh cÃ´ng vÃ¬ cÃ¹ng loáº¡i TuDo

### **Test Case 9: ÄÄƒng kÃ½ nhiá»u Lá»›p cÃ¹ng bá»™ mÃ´n (Há»£p lá»‡)**
1. ÄÄƒng kÃ½ dá»‹ch vá»¥ **YOGA Lop 7N** (chá»n lá»›p A)
2. ÄÄƒng kÃ½ dá»‹ch vá»¥ **YOGA Lop 30N** (chá»n lá»›p B)
3. **Káº¿t quáº£ mong Ä‘á»£i**: âœ… ThÃ nh cÃ´ng vÃ¬ Ä‘Æ°á»£c phÃ©p nhiá»u Lá»›p cÃ¹ng bá»™ mÃ´n

## ğŸ”§ CÃ¡ch test trÃªn há»‡ thá»‘ng

### **BÆ°á»›c 1: ÄÄƒng nháº­p**
- Truy cáº­p: `/login`
- ÄÄƒng nháº­p vá»›i tÃ i khoáº£n USER

### **BÆ°á»›c 2: VÃ o trang Ä‘Äƒng kÃ½ dá»‹ch vá»¥**
- Truy cáº­p: `/dich-vu-gym/dang-kydv`
- Chá»n bá»™ mÃ´n Ä‘á»ƒ test

### **BÆ°á»›c 3: Thá»±c hiá»‡n test case**
- ÄÄƒng kÃ½ dá»‹ch vá»¥ Ä‘áº§u tiÃªn
- Kiá»ƒm tra giá» hÃ ng hiá»ƒn thá»‹ Ä‘Ãºng
- Thá»­ Ä‘Äƒng kÃ½ dá»‹ch vá»¥ thá»© hai
- Kiá»ƒm tra thÃ´ng bÃ¡o lá»—i

### **BÆ°á»›c 4: Kiá»ƒm tra Server Log**
Quan sÃ¡t console Ä‘á»ƒ tháº¥y:
```
=== KIá»‚M TRA VALIDATION Dá»ŠCH Vá»¤ ===
MÃ£ DV muá»‘n Ä‘Äƒng kÃ½: DV09
Cart services raw: 'DV13'
Danh sÃ¡ch DV trong giá»: [DV13]
âŒ Validation TuDo failed: âŒ KhÃ´ng thá»ƒ Ä‘Äƒng kÃ½ dá»‹ch vá»¥ Tá»± Do YOGA...
```

## ğŸ¯ Äiá»ƒm cáº§n kiá»ƒm tra

### **Frontend JavaScript**
- [x] Gá»i API validation trÆ°á»›c khi Ä‘Äƒng kÃ½
- [x] Hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i Ä‘Ãºng cÃ¡ch
- [x] KhÃ´ng cho phÃ©p thÃªm vÃ o giá» hÃ ng khi validation fail
- [x] Session storage hoáº¡t Ä‘á»™ng Ä‘Ãºng

### **Backend Java**
- [x] API `/api/dichvu-validation/kiem-tra` hoáº¡t Ä‘á»™ng
- [x] Logic kiá»ƒm tra TuDo vs Lop/PT Ä‘Ãºng
- [x] Logic kiá»ƒm tra Lop/PT vs TuDo Ä‘Ãºng  
- [x] Xá»­ lÃ½ exception vÃ  error message

### **Database**
- [x] Láº¥y thÃ´ng tin bá»™ mÃ´n tá»« dá»‹ch vá»¥ Ä‘Ãºng
- [x] So sÃ¡nh mÃ£ bá»™ mÃ´n chÃ­nh xÃ¡c
- [x] Enum LoaiDichVu hoáº¡t Ä‘á»™ng Ä‘Ãºng

## ğŸš€ ThÃ´ng bÃ¡o lá»—i máº«u

### **Conflict TuDo vs Lop/PT:**
```
âŒ KhÃ´ng thá»ƒ Ä‘Äƒng kÃ½ dá»‹ch vá»¥ Tá»± Do YOGA vÃ¬ báº¡n Ä‘Ã£ cÃ³ dá»‹ch vá»¥ Lá»›p cá»§a YOGA trong giá» hÃ ng. Má»—i bá»™ mÃ´n chá»‰ Ä‘Æ°á»£c chá»n má»™t loáº¡i dá»‹ch vá»¥ (Tá»± Do HOáº¶C Lá»›p/PT).

âŒ KhÃ´ng thá»ƒ Ä‘Äƒng kÃ½ dá»‹ch vá»¥ Personal Trainer GYM vÃ¬ báº¡n Ä‘Ã£ cÃ³ dá»‹ch vá»¥ Tá»± Do cá»§a GYM trong giá» hÃ ng. Má»—i bá»™ mÃ´n chá»‰ Ä‘Æ°á»£c chá»n má»™t loáº¡i dá»‹ch vá»¥ (Tá»± Do HOáº¶C Lá»›p/PT).
```

### **Conflict PT Duplicate:**
```
âŒ KhÃ´ng thá»ƒ Ä‘Äƒng kÃ½ thÃªm dá»‹ch vá»¥ Personal Trainer GYM vÃ¬ báº¡n Ä‘Ã£ cÃ³ dá»‹ch vá»¥ PT khÃ¡c cá»§a GYM trong giá» hÃ ng. Má»—i bá»™ mÃ´n chá»‰ Ä‘Æ°á»£c chá»n má»™t dá»‹ch vá»¥ Personal Trainer.

âŒ KhÃ´ng thá»ƒ Ä‘Äƒng kÃ½ thÃªm dá»‹ch vá»¥ Personal Trainer CARDIO vÃ¬ báº¡n Ä‘Ã£ cÃ³ dá»‹ch vá»¥ PT khÃ¡c cá»§a CARDIO trong giá» hÃ ng. Má»—i bá»™ mÃ´n chá»‰ Ä‘Æ°á»£c chá»n má»™t dá»‹ch vá»¥ Personal Trainer.
```

## ğŸ“‚ Files Ä‘Ã£ táº¡o/sá»­a

### **Java Backend**
- `DichVuValidationService.java` - Service validation logic
- `DichVuValidationController.java` - REST API endpoint

### **JavaScript Frontend** 
- `dangkydv.js` - ThÃªm validation cho TuDo
- `chonlop.html` - ThÃªm validation cho Lá»›p
- `chonpt.html` - ThÃªm validation cho PT

### **CÃ¡c thay Ä‘á»•i chÃ­nh**
1. Kiá»ƒm tra validation trÆ°á»›c khi Ä‘Äƒng kÃ½
2. Hiá»ƒn thá»‹ thÃ´ng bÃ¡o lá»—i thÃ¢n thiá»‡n
3. KhÃ´ng cho phÃ©p conflict giá»¯a TuDo vÃ  Lop/PT cÃ¹ng bá»™ mÃ´n
4. Logging chi tiáº¿t Ä‘á»ƒ debug

---

**âœ… TÃ­nh nÄƒng hoÃ n thÃ nh vÃ  sáºµn sÃ ng test!** 